import FreeQueue from"../../src/free-queue.js";import{QUEUE_SIZE}from"./constants.js";const toggleButton=document.getElementById("toggle");toggleButton.disabled=!1;const inputQueue=new FreeQueue(QUEUE_SIZE,1),outputQueue=new FreeQueue(QUEUE_SIZE,1),atomicState=new Int32Array(new SharedArrayBuffer(1*Int32Array.BYTES_PER_ELEMENT));let audioContext=null,isPlaying=!1;const createAudioContext=async()=>{const e=new AudioContext;await e.audioWorklet.addModule("basic-processor.js");const t=new OscillatorNode(e),o=new AudioWorkletNode(e,"basic-processor",{processorOptions:{inputQueue,outputQueue,atomicState}});return t.connect(o).connect(e.destination),e.suspend(),t.start(),console.log("AudioContext created."),e},toggleButtonClickHandler=async()=>{if(!audioContext)try{audioContext=await createAudioContext()}catch(e){return toggleButton.disabled=!0,void console.error(e)}isPlaying?(audioContext.suspend(),isPlaying=!1,toggleButton.style.backgroundColor="green",toggleButton.innerHTML="START"):(audioContext.resume(),isPlaying=!0,toggleButton.style.backgroundColor="red",toggleButton.innerHTML="STOP")};toggleButton.onclick=toggleButtonClickHandler;const worker=new Worker("worker.js",{type:"module"});worker.postMessage({type:"init",data:{inputQueue,outputQueue,atomicState}});